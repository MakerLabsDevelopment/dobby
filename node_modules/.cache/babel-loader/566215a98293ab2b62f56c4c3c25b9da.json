{"ast":null,"code":"var _jsxFileName = \"/Users/nassarhayat/apps/textiletable/js-examples/bucket-photo-gallery/src/App.tsx\";\nimport React from 'react';\nimport Avatar from './Avatar';\nimport Table from './Table';\nimport \"semantic-ui-css/semantic.min.css\";\nimport { Buckets, PrivateKey, Client, ThreadID, Where } from '@textile/hub';\nimport { Button, Header, Segment } from \"semantic-ui-react\";\nimport './App.css';\n\nclass App extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.keyInfo = {\n      key: 'bgdhubuxfallvfnvzeiaxip4kee'\n    };\n    this.state = {\n      metadata: [],\n      isLoading: false,\n      isDragActive: false,\n      index: {\n        author: '',\n        date: 0,\n        paths: []\n      }\n    };\n\n    this.getIdentity = async () => {\n      try {\n        var storedIdent = localStorage.getItem(\"identity\");\n\n        if (storedIdent === null) {\n          throw new Error('No identity');\n        }\n\n        const restored = PrivateKey.fromString(storedIdent);\n        return restored;\n      } catch (e) {\n        /**\n         * If any error, create a new identity.\n         */\n        try {\n          const identity = await PrivateKey.fromRandom();\n          const identityString = identity.toString();\n          localStorage.setItem(\"identity\", identityString);\n          return identity;\n        } catch (err) {\n          return err.message;\n        }\n      }\n    };\n\n    this.getBucketKey = async () => {\n      if (!this.state.identity) {\n        throw new Error('Identity not set');\n      }\n\n      const buckets = await Buckets.withKeyInfo(this.keyInfo); // Authorize the user and your insecure keys with getToken\n\n      await buckets.getToken(this.state.identity); // console.log(buckets, this.state.identity)\n\n      const buck = await buckets.getOrCreate('io.textile.dropzone'); // console.log(buck.root, 'ROOT')\n\n      if (!buck.root) {\n        throw new Error('Failed to open bucket');\n      }\n\n      return {\n        buckets: buckets,\n        bucketKey: buck.root.key\n      };\n    };\n\n    this.getClientInfo = async () => {\n      if (!this.state.identity) {\n        throw new Error('Identity not set');\n      }\n\n      const client = await Client.withKeyInfo(this.keyInfo);\n      await client.getToken(this.state.identity);\n      return client;\n    };\n\n    this.createThread = async () => {\n      const threadId = ThreadID.fromRandom();\n      return threadId;\n    };\n\n    this.getDatabase = async (client, threadId) => {\n      await client.newDB(threadId);\n    };\n\n    this.createCollection = async () => {\n      if (!this.state.client || !this.state.threadId || !this.state.buckets) {\n        console.error('No client or threadId');\n        return;\n      }\n\n      const schema = {\n        $schema: 'http://json-schema.org/draft-07/schema#',\n        title: 'Astronaut',\n        type: 'object',\n        properties: {\n          _id: {\n            type: 'string'\n          },\n          name: {\n            type: 'string'\n          },\n          missions: {\n            type: 'number',\n            minimum: 0\n          }\n        }\n      };\n      await this.state.client.newCollection(this.state.threadId, 'Astronaut', schema);\n      const jsonData = {\n        \"_id\": \"1\",\n        \"name\": \"Nanssar\",\n        \"missions\": 6\n      };\n      const jsonData2 = {\n        \"_id\": \"2\",\n        \"name\": \"Fred\",\n        \"missions\": 6\n      };\n      await this.state.client.create(this.state.threadId, 'Astronaut', [jsonData]);\n      await this.state.client.create(this.state.threadId, 'Astronaut', [jsonData2]);\n      await this.state.client.save(this.state.threadId, 'Astronaut', [jsonData]);\n      await this.state.client.save(this.state.threadId, 'Astronaut', [jsonData2]);\n      const query = new Where('missions').eq(6);\n      const list = await this.state.client.find(this.state.threadId, 'Astronaut', query);\n      this.setState({\n        rows: list.instancesList\n      });\n      console.log('list', list);\n    };\n\n    this.getBucketLinks = async () => {\n      if (!this.state.buckets || !this.state.bucketKey) {\n        console.error('No bucket client or root key');\n        return;\n      }\n\n      const links = await this.state.buckets.links(this.state.bucketKey); // console.log(links, 'LOKN')\n\n      this.setState({ ...links\n      });\n    };\n  }\n\n  async componentDidMount() {\n    // Clear your user during development\n    // await localStorage.clear()\n    const identity = await this.getIdentity(); // you might want to do the I18N setup here\n\n    this.setState({\n      identity: identity\n    }); // get their photo bucket\n\n    const {\n      bucketKey,\n      buckets\n    } = await this.getBucketKey();\n    this.setState({\n      buckets: buckets,\n      bucketKey: bucketKey\n    });\n    await this.getBucketLinks();\n    const client = await this.getClientInfo();\n    const threadId = await this.createThread();\n    await this.getDatabase(client, threadId);\n    console.log('CLI', client);\n    this.setState({\n      client: client,\n      threadId: threadId\n    });\n  }\n  /**\n   * getIdentity uses a basic private key identity.\n   * The user's identity will be cached client side. This is long\n   * but ephemeral storage not sufficient for production apps.\n   *\n   * Read more here:\n   * https://docs.textile.io/tutorials/hub/libp2p-identities/\n   */\n\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Segment.Group, {\n      style: {\n        height: \"100%\",\n        border: 0,\n        boxShadow: \"0px 0px 0px\",\n        borderRadius: 0\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Segment, {\n      clearing: true,\n      className: \"nav\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Header, {\n      className: \"avatar\",\n      as: \"h2\",\n      floated: \"left\",\n      title: this.state.identity ? this.state.identity.toString() : 'identity',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }\n    }, this.state.identity && /*#__PURE__*/React.createElement(Avatar, {\n      identity: this.state.identity.toString(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 39\n      }\n    })), this.state.url && /*#__PURE__*/React.createElement(\"a\", {\n      href: this.state.url,\n      target: \"_blank\",\n      rel: \"noopener noreferrer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      className: \"link\",\n      floated: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }\n    }, \"BUCKET\")), this.state.www && /*#__PURE__*/React.createElement(\"a\", {\n      href: this.state.www,\n      target: \"_blank\",\n      rel: \"noopener noreferrer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      className: \"link\",\n      floated: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }\n    }, \"WWW\")), this.state.ipns && /*#__PURE__*/React.createElement(\"a\", {\n      href: this.state.ipns,\n      target: \"_blank\",\n      rel: \"noopener noreferrer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      className: \"link\",\n      floated: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }\n    }, \"IPNS\")), this.state.client && this.state.threadId && /*#__PURE__*/React.createElement(Button, {\n      onClick: () => this.createCollection(),\n      floated: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 15\n      }\n    }, \"Create New Collection\")), /*#__PURE__*/React.createElement(Table, {\n      rows: this.state.rows,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 11\n      }\n    })));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/nassarhayat/apps/textiletable/js-examples/bucket-photo-gallery/src/App.tsx"],"names":["React","Avatar","Table","Buckets","PrivateKey","Client","ThreadID","Where","Button","Header","Segment","App","Component","keyInfo","key","state","metadata","isLoading","isDragActive","index","author","date","paths","getIdentity","storedIdent","localStorage","getItem","Error","restored","fromString","e","identity","fromRandom","identityString","toString","setItem","err","message","getBucketKey","buckets","withKeyInfo","getToken","buck","getOrCreate","root","bucketKey","getClientInfo","client","createThread","threadId","getDatabase","newDB","createCollection","console","error","schema","$schema","title","type","properties","_id","name","missions","minimum","newCollection","jsonData","jsonData2","create","save","query","eq","list","find","setState","rows","instancesList","log","getBucketLinks","links","componentDidMount","render","height","border","boxShadow","borderRadius","url","www","ipns"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Avatar from './Avatar';\nimport Table from './Table';\n\nimport \"semantic-ui-css/semantic.min.css\";\nimport { Buckets, KeyInfo, PrivateKey, Client, ThreadID, Where } from '@textile/hub'\nimport { Button, Header, Segment } from \"semantic-ui-react\";\n\nimport { AppState } from './Types'\nimport './App.css';\n\nclass App extends React.Component {\n  keyInfo: KeyInfo = {\n    key: 'bgdhubuxfallvfnvzeiaxip4kee',\n  }\n  state: AppState = {\n    metadata: [],\n    isLoading: false,\n    isDragActive: false,\n    index: {\n      author: '',\n      date: 0,\n      paths: []\n    }\n  }\n  async componentDidMount() {\n    // Clear your user during development\n    // await localStorage.clear()\n    const identity = await this.getIdentity()\n    // you might want to do the I18N setup here\n    this.setState({\n      identity: identity\n    })\n\n    // get their photo bucket\n    const {bucketKey, buckets} = await this.getBucketKey()\n    this.setState({\n      buckets: buckets,\n      bucketKey: bucketKey\n    })\n\n    await this.getBucketLinks()\n\n    const client = await this.getClientInfo()\n    const threadId = await this.createThread()\n    await this.getDatabase(client, threadId)\n    console.log('CLI', client)\n    this.setState({\n      client: client,\n      threadId: threadId\n    })\n  }\n\n  /**\n   * getIdentity uses a basic private key identity.\n   * The user's identity will be cached client side. This is long\n   * but ephemeral storage not sufficient for production apps.\n   *\n   * Read more here:\n   * https://docs.textile.io/tutorials/hub/libp2p-identities/\n   */\n  getIdentity = async (): Promise<PrivateKey> => {\n    try {\n      var storedIdent = localStorage.getItem(\"identity\")\n      if (storedIdent === null) {\n        throw new Error('No identity')\n      }\n      const restored = PrivateKey.fromString(storedIdent)\n      return restored\n    }\n    catch (e) {\n      /**\n       * If any error, create a new identity.\n       */\n      try {\n        const identity = await PrivateKey.fromRandom()\n        const identityString = identity.toString()\n        localStorage.setItem(\"identity\", identityString)\n        return identity\n      } catch (err) {\n        return err.message\n      }\n    }\n  }\n\n  /**\n   * getBucketKey will create a new Buckets client with the UserAuth\n   * and then open our custom bucket named, 'io.textile.dropzone'\n   */\n  getBucketKey = async () => {\n    if (!this.state.identity) {\n      throw new Error('Identity not set')\n    }\n    const buckets = await Buckets.withKeyInfo(this.keyInfo)\n    // Authorize the user and your insecure keys with getToken\n    await buckets.getToken(this.state.identity)\n    // console.log(buckets, this.state.identity)\n    const buck = await buckets.getOrCreate('io.textile.dropzone')\n    // console.log(buck.root, 'ROOT')\n    if (!buck.root) {\n      throw new Error('Failed to open bucket')\n    }\n    return {buckets: buckets, bucketKey: buck.root.key};\n  }\n\n  getClientInfo = async () => {\n    if (!this.state.identity) {\n      throw new Error('Identity not set')\n    }\n    const client = await Client.withKeyInfo(this.keyInfo)\n    await client.getToken(this.state.identity)\n    return client\n  }\n\n  createThread = async () => {\n    const threadId = ThreadID.fromRandom()\n    return threadId\n  }\n\n  getDatabase = async (client: Client, threadId: ThreadID) => {\n    await client.newDB(threadId)\n  }\n\n  createCollection = async () => {\n    if (!this.state.client || !this.state.threadId || !this.state.buckets) {\n      console.error('No client or threadId')\n      return\n    }\n    const schema = {\n      $schema: 'http://json-schema.org/draft-07/schema#',\n      title: 'Astronaut',\n      type: 'object',\n      properties: {\n        _id: { type: 'string' },\n        name: { type: 'string' },\n        missions: {\n          type: 'number',\n          minimum: 0,\n        },\n      },\n    }\n    await this.state.client.newCollection(this.state.threadId, 'Astronaut', schema);\n\n    const jsonData = { \"_id\": \"1\", \"name\": \"Nanssar\", \"missions\": 6 }\n    const jsonData2 = { \"_id\": \"2\", \"name\": \"Fred\", \"missions\": 6 }\n    await this.state.client.create(this.state.threadId, 'Astronaut', [ jsonData ]);\n    await this.state.client.create(this.state.threadId, 'Astronaut', [ jsonData2 ]);\n    await this.state.client.save(this.state.threadId, 'Astronaut', [ jsonData ]);\n    await this.state.client.save(this.state.threadId, 'Astronaut', [ jsonData2 ]);\n\n    const query = new Where('missions').eq(6)\n    const list = await this.state.client.find(this.state.threadId, 'Astronaut', query);\n    this.setState({\n      rows: list.instancesList,\n    })\n    console.log('list', list)\n  }\n\n  /**\n   * getBucketLinks returns all the protocol endpoints for the bucket.\n   * Read more:\n   * https://docs.textile.io/hub/buckets/#bucket-protocols\n   */\n  getBucketLinks = async () => {\n    if (!this.state.buckets || !this.state.bucketKey) {\n      console.error('No bucket client or root key')\n      return\n    }\n    const links = await this.state.buckets.links(this.state.bucketKey)\n    // console.log(links, 'LOKN')\n    this.setState({\n      ...links\n    })\n  }\n\n  render () {\n    return (\n      <div className=\"App\">\n        <Segment.Group style={{ height: \"100%\", border: 0, boxShadow: \"0px 0px 0px\", borderRadius: 0 }}>\n          <Segment clearing className=\"nav\">\n            <Header className=\"avatar\" as=\"h2\" floated=\"left\" title={this.state.identity ? this.state.identity.toString() : 'identity'}>\n              {this.state.identity && <Avatar identity={this.state.identity.toString()}/>}\n            </Header>\n            {this.state.url &&\n              <a href={this.state.url} target=\"_blank\" rel=\"noopener noreferrer\">\n                <Button\n                  className=\"link\"\n                  floated=\"right\"\n                >BUCKET</Button>\n              </a>\n            }\n            {this.state.www &&\n              <a href={this.state.www} target=\"_blank\" rel=\"noopener noreferrer\">\n                <Button\n                  className=\"link\"\n                  floated=\"right\"\n                >WWW</Button>\n              </a>\n            }\n            {this.state.ipns &&\n              <a href={this.state.ipns} target=\"_blank\" rel=\"noopener noreferrer\">\n                <Button\n                  className=\"link\"\n                  floated=\"right\"\n                >IPNS</Button>\n              </a>\n            }\n            {this.state.client && this.state.threadId &&\n              <Button onClick={() => this.createCollection()} floated=\"right\">Create New Collection</Button>\n            }\n          </Segment>\n          <Table rows={this.state.rows}/>\n        </Segment.Group>\n      </div>\n    )\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}